{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- ========================= SECTION CONTENT ========================= -->
<section class="section-conten padding-y bg">
{% include 'includes/alerts.html' %}
<div class="container">
    <div class="row">
    {% include 'includes/dashboard_sidebar.html' %}
    <main class="col-md-9">
        <article class="card">
        <header class="card-header">
            <strong class="d-inline-block mr-3">Your Order History</strong>
        </header>
        <div class="card-body">
            {% if payment_error %}
                <div class="alert alert-danger" role="alert">
                    Payment failed. Please try again.
                </div>
            {% endif %}
            <div class="row"> 
            <div class="col-md-12">
            <table class="table table-hover">
    <thead>
        <tr>
            <th scope="col">Order No</th>
            <th scope="col">Billing Name</th>
            <th scope="col">Phone Number</th>
            <th scope="col">Order Total</th>
            <th scope="col">Date</th>
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for order in orders %}
        <tr>
            <th scope="row"><a href="{% url 'accounts:order_detail' order.order_number %}">{{order.order_number}}</a></th>
            <td>{{order.full_name}}</td>
            <td>{{order.phone_number}}</td>
            <td>${{order.final_total}}</td>
            <td>{{order.created_at}}</td>
            <td>{{order.status}}</td>
            <td>
                <div class="btn-group" role="group">
                    {% if order.status == 'Completed' %}
                    <a href="{% url 'cancell_order' order_number=order.order_number %}" class="btn btn-sm btn-danger btn-block" onclick="return confirm('Are you sure you want to cancel the order');" style="font-size: 14px;">Cancel</a>
                    
                    {% elif order.status == 'Delivered' %}
                    <form action="{% url 'accounts:return_order' order.order_number %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="order_number" value="{{ order.order_number }}">
                        <button type="submit" class="btn btn-danger btn-block" onclick="return confirm('Are you sure you want to return the order?');" style="font-size: 14px;">Return</button>
                    </form>
                    {% elif order.status == 'Payment Failed' %}
                    <a href="#" class="btn btn-sm btn-warning btn-block" style="font-size: 14px;">Retry Payment</a>
                    {% endif %}
                </div>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

 <!-- Pagination controls -->
 <div class="pagination justify-content-center">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            {% if orders.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ orders.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}
            {% for num in orders.paginator.page_range %}
                {% if orders.number == num %}
                    <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
                {% elif num > orders.number|add:'-5' and num < orders.number|add:'5' %}
                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            {% if orders.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ orders.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
            </div>
            </div> <!-- row.// -->
        </div> <!-- card-body .// -->
        </article> <!-- order-group.// --> 
    </main>
</div> <!-- row.// -->
</div>
</div>
</div>
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->

<br>
<br>
<br>
<br>
<br>
<br>
{% endblock content %}
